
# Building a Custom Audio Processing System
## Project Creation
1. Copy the passthrough example project to a new directory within Simulink Models folder
2. Rename the project folder
3. Open the renamed folder and rename the Simulink project
4. Open the model.json file
5. Update the device name to match the renamed Simulink project

## Model Configuration
### model.json
This file is used to specify various hardware-related parameters for the Simulink system.  Examples include the FPGA target, sample frequency, and registers for the audio processing design.  This file is split into two sections; system and devices.

#### System

The **system** node of the `model.json` file describes the target FPGA development board and the attributes of that target.  These parameters are generally dependent on the hardware itself and therefore are fixed.  An example system node and description of its parameters are shown below.

```    
"system": {
  "target": "audiomini",
  "sampleClockFrequency": 48000,
  "systemClockFrequency": 98304000,
  "processing": "channel",
  "audioIn": {
    "wordLength": 24,
    "fractionLength": 23,
    "signed": true,
    "numberOfChannels": 2
  },
    "audioOut": {
    "wordLength": 24,
    "fractionLength": 23,
    "signed": true,
    "numberOfChannels": 2
  }
}
```
- `target`: The hardware to run the device.  Current supported values are `audiomini`, `reflex`, and `audioblade`
- `sampleClockFrequency`: The sampling frequency of the audio codec
- `systemClockFequency`: The clock frequency of the FPGA design.  In the audio examples this is generated by a pll attached to a 12.288 MHz crystal.
- `processing`: The type of processing to perform.  `channel` processing combines left and right audio data on a single data signal and uses an Avalon streaming interface.  `sample` simply passes the sampled audio directly into the design without channel or valid signals.
- `audioIn` and `audioOut`: Descriptors of the audio interfaces to the AD1939 codec.
	- `wordLength`: The length, in bits, of the audio word
	- `fractionLength`: The number of fractional bits in the data word
	- `signed`: Whether or not to treat the word as a signed or unsigned word
	- `numberOfChannels`: The number of channels on a single data signal.

#### Device
The device node of the `model.json` file configures the user-defined registers and controls for custom designs.  
```
"devices": [
  {
    "name": "passthrough",
    "registers": [
    {
      "dataType": {
      "fractionLength": 8,
      "signed": true,
      "type": "sfix16_en8",
      "wordLength": 16
      },
        "defaultValue": 0,
        "name": "leftGain",
        "registerNumber": 0
      }
    ]
  }
]
```



## Adding New Registers
*Coming Soon*
## Model Referencing
*Coming Soon*